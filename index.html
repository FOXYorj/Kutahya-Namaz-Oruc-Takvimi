<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KÃ¼tahya Namaz Vakitleri & AsistanÄ±</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Plus+Jakarta+Sans:wght@400;500;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
  :root {
    /* Tema DeÄŸiÅŸkenleri */
    --primary: #105c48; 
    --primary-light: #e6f5f1;
    --accent: #d97706; 
    --text-dark: #1f2937;
    --text-gray: #6b7280;
    --bg-body: #f3f4f6;
    --bg-card: #ffffff;
    --border-color: #e5e7eb;
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    --radius-lg: 16px;
    --radius-md: 12px;
    --prayer-item-bg: #f8fafc;
  }

  /* KaranlÄ±k Mod */
  body.dark-mode {
    --primary: #34d399;
    --primary-light: #064e3b;
    --text-dark: #f3f4f6;
    --text-gray: #9ca3af;
    --bg-body: #111827;
    --bg-card: #1f2937;
    --border-color: #374151;
    --prayer-item-bg: #111827;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; transition: background-color 0.3s, border-color 0.3s, color 0.3s; }
  body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: var(--bg-body); color: var(--text-dark); min-height: 100vh; padding-bottom: 40px; }
  h1, h2, h3, h4 { font-family: 'Outfit', sans-serif; color: var(--text-dark); }

  .container { max-width: 1200px; margin: 0 auto; padding: 20px; }

  /* Header */
  header { text-align: center; padding: 30px 0; }
  .app-title { font-size: 2.2rem; font-weight: 700; color: var(--primary); margin-bottom: 5px; }
  body.dark-mode .app-title { color: var(--text-dark); }
  .app-subtitle { color: var(--text-gray); font-size: 1rem; }

  /* Kontrol Paneli */
  .control-bar {
    display: flex; justify-content: space-between; align-items: center;
    background: var(--bg-card); padding: 15px 25px;
    border-radius: var(--radius-lg); box-shadow: var(--shadow-sm);
    margin-bottom: 30px; gap: 20px; border: 1px solid var(--border-color); flex-wrap: wrap;
  }
  .district-wrapper { position: relative; min-width: 220px; flex: 1; }
  .district-wrapper i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--primary); pointer-events: none; }
  select { width: 100%; padding: 12px 20px 12px 45px; border: 1px solid var(--border-color); border-radius: var(--radius-md); font-family: inherit; color: var(--text-dark); background-color: var(--bg-body); appearance: none; outline: none; }
  
  .nav-buttons { display: flex; gap: 10px; background: var(--bg-body); padding: 5px; border-radius: var(--radius-md); }
  .btn { padding: 10px 18px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; color: var(--text-gray); background: transparent; }
  .btn.active { background: var(--bg-card); color: var(--primary); box-shadow: var(--shadow-sm); }
  .theme-toggle { width: 40px; height: 40px; border-radius: 50%; border: 1px solid var(--border-color); background: var(--bg-card); color: var(--text-dark); display: flex; align-items: center; justify-content: center; cursor: pointer; }

  /* Grid Sistemi */
  .main-grid { display: grid; grid-template-columns: 1fr 1.4fr; gap: 30px; }

  /* Sol Panel KartlarÄ± */
  .info-card, .tool-card {
    background: var(--bg-card); border-radius: var(--radius-lg);
    padding: 25px; box-shadow: var(--shadow-md); margin-bottom: 25px;
    border: 1px solid var(--border-color);
  }

  /* SayaÃ§lar */
  .timers-wrapper { display: flex; flex-direction: column; gap: 15px; margin-bottom: 20px; }
  
  /* SÄ±radaki Vakit SayacÄ± */
  .next-prayer-counter {
    background: linear-gradient(135deg, var(--primary) 0%, #064e3b 100%);
    color: white; padding: 15px; border-radius: var(--radius-md);
    display: flex; justify-content: space-between; align-items: center;
  }
  .next-prayer-info span { font-size: 0.85rem; opacity: 0.9; }
  .next-prayer-info strong { display: block; font-size: 1.1rem; }
  .next-timer { font-size: 1.6rem; font-weight: 700; font-variant-numeric: tabular-nums; }

  /* Ramazan SayacÄ± (Geri Geldi) */
  .ramadan-counter {
    background: linear-gradient(135deg, var(--accent) 0%, #b45309 100%);
    color: white; padding: 12px 15px; border-radius: var(--radius-md);
    display: flex; align-items: center; justify-content: space-between;
  }
  .ramadan-icon { font-size: 1.5rem; opacity: 0.8; }
  .ramadan-text { text-align: right; }
  .ramadan-text span { display: block; font-size: 0.75rem; opacity: 0.9; text-transform: uppercase; letter-spacing: 1px; }
  .ramadan-val { font-size: 1.1rem; font-weight: 700; }

  /* Namaz Listesi */
  .location-title h2 { font-size: 1.4rem; font-weight: 700; margin-bottom: 5px; display: flex; align-items: center; gap: 10px; }
  .copy-btn { background: none; border: none; color: var(--text-gray); cursor: pointer; font-size: 1rem; }
  .copy-btn:hover { color: var(--primary); }
  
  .prayer-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 20px; }
  .prayer-item { background: var(--prayer-item-bg); padding: 15px; border-radius: var(--radius-md); transition: transform 0.2s; border: 1px solid transparent; }
  .prayer-item.active { background: var(--bg-card); border-color: var(--primary); box-shadow: 0 0 0 2px var(--primary-light) inset; }
  body.dark-mode .prayer-item.active { background: var(--primary-light); box-shadow: none; border-color: transparent; }
  body.dark-mode .prayer-item.active * { color: white !important; }
  .prayer-header { display: flex; align-items: center; gap: 8px; margin-bottom: 5px; color: var(--text-gray); font-size: 0.9rem; }
  .prayer-item .time { font-size: 1.5rem; font-weight: 700; }

  /* SaÄŸ Panel: Takvim & AraÃ§lar */
  .calendar-wrapper { background: var(--bg-card); border-radius: var(--radius-lg); padding: 25px; box-shadow: var(--shadow-md); border: 1px solid var(--border-color); margin-bottom: 25px; }
  .cal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
  .cal-nav button { width: 32px; height: 32px; border-radius: 50%; border: none; background: var(--bg-body); cursor: pointer; color: var(--text-dark); }
  .cal-nav button:hover { background: var(--primary); color: white; }
  .cal-grid-header, .cal-grid-days { display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; gap: 5px; }
  .cal-grid-header span { font-size: 0.8rem; font-weight: 600; color: var(--text-gray); }
  .cal-day { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; border-radius: 8px; cursor: pointer; font-size: 0.9rem; }
  .cal-day:hover:not(.empty) { background: var(--primary-light); color: var(--primary); }
  .cal-day.today { background: var(--primary); color: white; }
  .cal-day.religious { color: var(--accent); font-weight: 700; }

  /* YENÄ° Ã–ZELLÄ°KLER GRÄ°DÄ° */
  .tools-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
  
  .mini-tool-card {
    background: var(--bg-card); padding: 15px; border-radius: var(--radius-md);
    border: 1px solid var(--border-color); display: flex; flex-direction: column;
    align-items: center; text-align: center; cursor: pointer; transition: transform 0.2s;
    box-shadow: var(--shadow-sm);
  }
  .mini-tool-card:hover { transform: translateY(-3px); border-color: var(--primary); }
  .tool-icon { width: 40px; height: 40px; border-radius: 50%; background: var(--primary-light); color: var(--primary); display: flex; align-items: center; justify-content: center; font-size: 1.2rem; margin-bottom: 10px; }
  .tool-title { font-weight: 600; font-size: 0.9rem; margin-bottom: 5px; }
  .tool-desc { font-size: 0.75rem; color: var(--text-gray); }

  /* Ã–zellik 1: Zikirmatik */
  .zikir-container { text-align: center; }
  .zikir-btn { width: 80px; height: 80px; border-radius: 50%; background: var(--primary); color: white; border: 4px solid var(--primary-light); font-size: 1.5rem; cursor: pointer; margin: 10px 0; box-shadow: 0 4px 10px rgba(16,92,72,0.3); transition: transform 0.1s; }
  .zikir-btn:active { transform: scale(0.95); }
  .zikir-reset { background: none; border: 1px solid var(--text-gray); padding: 4px 10px; border-radius: 15px; font-size: 0.8rem; cursor: pointer; color: var(--text-gray); }

  /* Ã–zellik 3: KÄ±ble */
  .qibla-visual { width: 60px; height: 60px; border: 2px solid var(--border-color); border-radius: 50%; position: relative; margin: 10px auto; }
  .kaaba-icon { position: absolute; top: 5px; left: 50%; transform: translateX(-50%); font-size: 0.8rem; }
  .compass-arrow { position: absolute; top: 50%; left: 50%; width: 2px; height: 25px; background: var(--primary); transform-origin: bottom center; transform: translate(-50%, -100%) rotate(153deg); } /* KÃ¼tahya ~153 derece */
  .compass-arrow::after { content: ''; position: absolute; top: 0; left: -3px; border-left: 4px solid transparent; border-right: 4px solid transparent; border-bottom: 6px solid var(--primary); }

  /* Modal */
  .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); display: none; justify-content: center; align-items: center; z-index: 1000; }
  .modal-overlay.active { display: flex; }
  .modal-card { background: var(--bg-card); width: 90%; max-width: 450px; border-radius: 20px; padding: 20px; max-height: 80vh; overflow-y: auto; }
  .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; }
  .imsakiye-table { width: 100%; font-size: 0.85rem; border-collapse: collapse; }
  .imsakiye-table th { text-align: left; padding: 8px; color: var(--primary); }
  .imsakiye-table td { padding: 8px; border-bottom: 1px solid var(--border-color); }

  @media (max-width: 900px) {
    .main-grid { grid-template-columns: 1fr; }
    .control-bar { flex-direction: column; align-items: stretch; }
  }
</style>
</head>
<body>

<div class="modal-overlay" id="generic-modal">
  <div class="modal-card">
    <div class="modal-header">
      <h3 id="modal-title">BaÅŸlÄ±k</h3>
      <button onclick="closeModal()" style="background:none; border:none; font-size:1.5rem; cursor:pointer;">&times;</button>
    </div>
    <div id="modal-content"></div>
  </div>
</div>

<div class="container">
  <header>
    <h1 class="app-title">KÃ¼tahya Namaz Vakitleri</h1>
    <p class="app-subtitle">Ä°badetlerinizde modern yardÄ±mcÄ±nÄ±z.</p>
  </header>

  <div class="control-bar">
    <div class="district-wrapper">
      <i class="fas fa-map-pin"></i>
      <select id="district">
        <option value="KÃ¼tahya">KÃ¼tahya Merkez</option>
        <option value="TavÅŸanlÄ±">TavÅŸanlÄ±</option>
        <option value="Simav">Simav</option>
        <option value="Gediz">Gediz</option>
        <option value="Emet">Emet</option>
        <option value="AltÄ±ntaÅŸ">AltÄ±ntaÅŸ</option>
        <option value="DomaniÃ§">DomaniÃ§</option>
        <option value="HisarcÄ±k">HisarcÄ±k</option>
        <option value="Aslanapa">Aslanapa</option>
        <option value="Ã‡avdarhisar">Ã‡avdarhisar</option>
        <option value="DumlupÄ±nar">DumlupÄ±nar</option>
        <option value="Pazarlar">Pazarlar</option>
        <option value="Åžaphane">Åžaphane</option>
      </select>
    </div>

    <div class="nav-buttons">
      <button class="btn active" id="btn-today" onclick="switchView('today')"><i class="fas fa-clock"></i> BugÃ¼n</button>
      <button class="btn" id="btn-calendar" onclick="switchView('calendar')"><i class="fas fa-calendar-alt"></i> Takvim</button>
    </div>

    <button class="theme-toggle" onclick="toggleTheme()"><i class="fas fa-moon" id="theme-icon"></i></button>
  </div>

  <div class="main-grid">
    <div class="left-panel" id="today-panel">
      <div class="timers-wrapper">
        <div class="next-prayer-counter">
          <div class="next-prayer-info">
            <span>SÄ±radaki Vakit:</span>
            <strong id="next-prayer-name">HesaplanÄ±yor...</strong>
          </div>
          <div class="next-timer" id="next-prayer-timer">--:--:--</div>
        </div>

        <div class="ramadan-counter">
          <i class="fas fa-mosque ramadan-icon"></i>
          <div class="ramadan-text">
            <span>Ramazan'a Kalan</span>
            <div class="ramadan-val" id="ramadan-countdown">HesaplanÄ±yor...</div>
          </div>
        </div>
      </div>

      <div class="info-card">
        <div class="location-title">
          <h2>
            <span id="display-location">KÃ¼tahya Merkez</span>
            <button class="copy-btn" onclick="copyTimes()" title="Kopyala"><i class="fas fa-copy"></i></button>
          </h2>
          <div style="font-size: 0.9rem; color: var(--text-gray);" id="current-date-display">Tarih YÃ¼kleniyor...</div>
        </div>

        <div class="prayer-grid" id="prayer-times-container">
          <div style="grid-column:1/-1; text-align:center;"><i class="fas fa-spinner fa-spin"></i></div>
        </div>
      </div>

      <div class="tool-card" style="border-left: 4px solid var(--accent); cursor: pointer;" onclick="refreshEsma()">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
          <h4 style="color:var(--accent);">GÃ¼nÃ¼n EsmÃ¢sÄ±</h4>
          <i class="fas fa-sync-alt" style="font-size:0.8rem; color:var(--text-gray);"></i>
        </div>
        <h2 id="esma-name" style="margin-bottom:5px;">El-Melik</h2>
        <p id="esma-meaning" style="font-size:0.9rem; color:var(--text-gray);">BÃ¼tÃ¼n kainatÄ±n, gÃ¶rÃ¼nen ve gÃ¶rÃ¼nmeyen alemlerin sahibi.</p>
      </div>
    </div>

    <div class="right-panel">
      <div class="calendar-wrapper" id="calendar-view">
        <div class="cal-header">
          <h3 id="cal-month-year">Åžubat 2025</h3>
          <div class="cal-nav">
            <button onclick="changeMonth(-1)"><i class="fas fa-chevron-left"></i></button>
            <button onclick="changeMonth(1)"><i class="fas fa-chevron-right"></i></button>
          </div>
        </div>
        <div class="cal-grid-header"><span>Pz</span><span>Pt</span><span>Sa</span><span>Ã‡a</span><span>Pe</span><span>Cu</span><span>Ct</span></div>
        <div class="cal-grid-days" id="calendar-days-grid"></div>
      </div>

      <h3 style="margin-bottom:15px; font-size:1.1rem;">HÄ±zlÄ± AraÃ§lar</h3>
      <div class="tools-grid">
        <div class="mini-tool-card" onclick="openZikirmatik()">
          <div class="tool-icon"><i class="fas fa-fingerprint"></i></div>
          <div class="tool-title">Zikirmatik</div>
          <div class="tool-desc">Dijital SayaÃ§</div>
        </div>

        <div class="mini-tool-card">
          <div class="tool-icon"><i class="fas fa-compass"></i></div>
          <div class="tool-title">KÄ±ble YÃ¶nÃ¼</div>
          <div class="qibla-visual">
            <div class="kaaba-icon">ðŸ•‹</div>
            <div class="compass-arrow"></div>
          </div>
          <div class="tool-desc">KÃ¼tahya (~153Â°)</div>
        </div>

        <div class="mini-tool-card" onclick="generateFridayMsg()">
          <div class="tool-icon"><i class="fas fa-paper-plane"></i></div>
          <div class="tool-title">Cuma MesajÄ±</div>
          <div class="tool-desc">Kopyala & PaylaÅŸ</div>
        </div>

        <div class="mini-tool-card" onclick="showImsakiye()">
          <div class="tool-icon"><i class="fas fa-list-alt"></i></div>
          <div class="tool-title">Ä°msakiye</div>
          <div class="tool-desc">Ramazan Takvimi</div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// --- GLOBAL DEÄžÄ°ÅžKENLER ---
let currentMonth = new Date().getMonth();
let currentYear = new Date().getFullYear();
let currentDistrict = "KÃ¼tahya";
let monthlyDataCache = {};
let todayTimingsObj = {};
let zikirCount = 0;

// Esma Listesi (KÄ±sa Ã–rnek)
const esmaList = [
  { name: "Er-RahmÃ¢n", mean: "DÃ¼nyada bÃ¼tÃ¼n mahlÃ»kata merhamet eden." },
  { name: "Er-RahÃ®m", mean: "Ahirette mÃ¼minlere sonsuz merhamet edecek olan." },
  { name: "El-Melik", mean: "MÃ¼lkÃ¼n gerÃ§ek sahibi, her ÅŸeye gÃ¼cÃ¼ yeten." },
  { name: "El-KuddÃ»s", mean: "Her tÃ¼rlÃ¼ eksiklikten mÃ¼nezzeh olan." },
  { name: "Es-SelÃ¢m", mean: "KullarÄ±nÄ± tehlikelerden selamete Ã§Ä±karan." },
  { name: "El-MÃ¼â€™min", mean: "GÃ¼ven veren, emin kÄ±lan." },
  { name: "El-MÃ¼heymin", mean: "Her ÅŸeyi gÃ¶rÃ¼p gÃ¶zeten." },
  { name: "El-AzÃ®z", mean: "Ä°zzet sahibi, her ÅŸeye galip gelen." },
  { name: "El-CebbÃ¢r", mean: "Azamet ve kudret sahibi." },
  { name: "El-MÃ¼tekebbir", mean: "BÃ¼yÃ¼klÃ¼kte eÅŸi olmayan." }
];

// Cuma MesajlarÄ±
const fridayMsgs = [
  "CumanÄ±z mÃ¼barek, dualarÄ±nÄ±z kabul olsun.",
  "GÃ¶nÃ¼ller duada birleÅŸince Cuma gÃ¼zelleÅŸir. HayÄ±rlÄ± Cumalar.",
  "Rabbim bu mÃ¼barek gÃ¼nde gÃ¶nlÃ¼nÃ¼zden geÃ§enleri Ã¶mrÃ¼nÃ¼ze nasip etsin.",
  "DualarÄ±n geri Ã§evrilmeyeceÄŸi bu saatte Rabbim dualarÄ±mÄ±zÄ± kabul eylesin.",
  "Allah'Ä±n rahmeti ve bereketi Ã¼zerinize olsun. HayÄ±rlÄ± Cumalar."
];

// --- BAÅžLANGIÃ‡ ---
document.addEventListener('DOMContentLoaded', () => {
  updateDateDisplay();
  refreshEsma(); // Ä°lk Esma
  
  // Tema KontrolÃ¼
  if(localStorage.getItem('theme') === 'dark') {
    document.body.classList.add('dark-mode');
    document.getElementById('theme-icon').classList.replace('fa-moon', 'fa-sun');
  }

  // Veri Ã‡ekme
  fetchTodayTimes();
  fetchMonthlyTimes(currentYear, currentMonth + 1);

  // Ä°lÃ§e DeÄŸiÅŸimi
  document.getElementById('district').addEventListener('change', function() {
    currentDistrict = this.value;
    document.getElementById('display-location').textContent = this.options[this.selectedIndex].text;
    fetchTodayTimes();
    fetchMonthlyTimes(currentYear, currentMonth + 1);
  });

  // SayaÃ§larÄ± BaÅŸlat
  setInterval(updateNextPrayerCounter, 1000);
  setInterval(updateRamadanCountdown, 1000); // Ramazan sayacÄ± baÅŸlatÄ±ldÄ±
  updateRamadanCountdown(); // Hemen Ã§alÄ±ÅŸtÄ±r
});

// --- YENÄ° Ã–ZELLÄ°KLERÄ°N FONKSÄ°YONLARI ---

// Ã–zellik 1: Zikirmatik Modal
function openZikirmatik() {
  const content = `
    <div class="zikir-container">
      <h4 style="margin-bottom:10px; color:var(--text-gray);">Dijital Tesbih</h4>
      <div id="zikir-display" style="font-size:3rem; font-weight:700; font-family:'Outfit'; margin:10px 0;">${zikirCount}</div>
      <button class="zikir-btn" onclick="incZikir()">
        <i class="fas fa-hand-pointer"></i>
      </button>
      <br>
      <button class="zikir-reset" onclick="resetZikir()">SÄ±fÄ±rla</button>
    </div>
  `;
  showModal("Zikirmatik", content);
}
function incZikir() { zikirCount++; document.getElementById('zikir-display').innerText = zikirCount; }
function resetZikir() { zikirCount = 0; document.getElementById('zikir-display').innerText = 0; }

// Ã–zellik 2: Esma Yenileme
function refreshEsma() {
  const rnd = esmaList[Math.floor(Math.random() * esmaList.length)];
  document.getElementById('esma-name').innerText = rnd.name;
  document.getElementById('esma-meaning').innerText = rnd.mean;
}

// Ã–zellik 4: Cuma MesajÄ±
function generateFridayMsg() {
  const msg = fridayMsgs[Math.floor(Math.random() * fridayMsgs.length)];
  navigator.clipboard.writeText(msg).then(() => {
    alert("Mesaj kopyalandÄ±:\n" + msg);
  });
}

// Ã–zellik 5: Ä°msakiye
function showImsakiye() {
  // Basitlik iÃ§in ÅŸu anki ayÄ±n verilerini tablo yapÄ±yoruz. 
  // GerÃ§ek bir uygulamada Ramazan ayÄ±nÄ± filtrelemek gerekir.
  let tableHtml = `<table class="imsakiye-table"><thead><tr><th>GÃ¼n</th><th>Ä°msak</th><th>AkÅŸam</th></tr></thead><tbody>`;
  
  const days = Object.keys(monthlyDataCache).sort((a,b) => a-b);
  days.forEach(d => {
    const t = monthlyDataCache[d].timings;
    tableHtml += `<tr><td>${d} ${document.getElementById('cal-month-year').textContent.split(' ')[0]}</td><td>${t.Fajr.split(' ')[0]}</td><td>${t.Maghrib.split(' ')[0]}</td></tr>`;
  });
  tableHtml += `</tbody></table>`;
  
  showModal("AylÄ±k Namaz Vakitleri (Ä°msakiye)", tableHtml);
}

// Ramazan SayacÄ± (Geri Getirilen Ã–zellik)
function updateRamadanCountdown() {
  // 2026 Ramazan: 18 Åžubat (Sabit)
  const ramadanDate = new Date("2026-02-18T00:00:00");
  const now = new Date();
  const diff = ramadanDate - now;

  const el = document.getElementById('ramadan-countdown');

  if (diff <= 0) {
    el.innerText = "HoÅŸgeldin Ya Åžehri Ramazan";
    return;
  }

  const days = Math.floor(diff / (1000 * 60 * 60 * 24));
  const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  
  el.innerText = `${days} GÃ¼n ${hours} Saat`;
}

// --- STANDART FONKSÄ°YONLAR ---
function copyTimes() {
  if (!todayTimingsObj.Fajr) return;
  const t = todayTimingsObj;
  const text = `ðŸ“… ${document.getElementById('current-date-display').textContent}\nðŸ“ ${currentDistrict} Namaz Vakitleri\n\nÄ°msak: ${t.Fajr}\nGÃ¼neÅŸ: ${t.Sunrise}\nÃ–ÄŸle: ${t.Dhuhr}\nÄ°kindi: ${t.Asr}\nAkÅŸam: ${t.Maghrib}\nYatsÄ±: ${t.Isha}`;
  navigator.clipboard.writeText(text).then(() => alert("Vakitler kopyalandÄ±!"));
}

async function fetchTodayTimes() {
  try {
    const res = await fetch(`https://api.aladhan.com/v1/timingsByCity?city=${encodeURIComponent(currentDistrict)}&country=Turkey&method=13`);
    const data = await res.json();
    if(data.code === 200) {
      todayTimingsObj = data.data.timings;
      renderPrayerCards(data.data.timings);
    }
  } catch (e) { console.error(e); }
}

async function fetchMonthlyTimes(year, month) {
  try {
    const res = await fetch(`https://api.aladhan.com/v1/calendarByCity?city=${encodeURIComponent(currentDistrict)}&country=Turkey&method=13&month=${month}&year=${year}`);
    const data = await res.json();
    if(data.code === 200) {
      monthlyDataCache = {};
      data.data.forEach(d => monthlyDataCache[parseInt(d.date.gregorian.day)] = d);
      renderCalendar(year, month);
    }
  } catch (e) { console.error(e); }
}

function renderPrayerCards(timings) {
  const map = [
    { k: 'Fajr', l: 'Ä°msak', i: 'fa-cloud-moon' },
    { k: 'Sunrise', l: 'GÃ¼neÅŸ', i: 'fa-sun' },
    { k: 'Dhuhr', l: 'Ã–ÄŸle', i: 'fa-sun' },
    { k: 'Asr', l: 'Ä°kindi', i: 'fa-cloud-sun' },
    { k: 'Maghrib', l: 'AkÅŸam', i: 'fa-moon' },
    { k: 'Isha', l: 'YatsÄ±', i: 'fa-star' }
  ];
  
  const now = new Date();
  const curMin = now.getHours() * 60 + now.getMinutes();
  let activeIdx = -1;
  map.forEach((item, idx) => {
    const [h, m] = timings[item.k].split(':');
    if (curMin >= h * 60 + parseInt(m)) activeIdx = idx;
  });
  if (activeIdx === -1 && curMin < 300) activeIdx = 5;

  let html = '';
  map.forEach((item, idx) => {
    html += `
      <div class="prayer-item ${idx === activeIdx ? 'active' : ''}">
        <div class="prayer-header"><i class="fas ${item.i}"></i> ${item.l}</div>
        <div class="time">${timings[item.k].split(' ')[0]}</div>
      </div>
    `;
  });
  document.getElementById('prayer-times-container').innerHTML = html;
}

function renderCalendar(year, month) {
  const grid = document.getElementById('calendar-days-grid');
  const mNames = ["Ocak", "Åžubat", "Mart", "Nisan", "MayÄ±s", "Haziran", "Temmuz", "AÄŸustos", "EylÃ¼l", "Ekim", "KasÄ±m", "AralÄ±k"];
  document.getElementById('cal-month-year').textContent = `${mNames[month-1]} ${year}`;
  
  const firstDay = new Date(year, month - 1, 1).getDay();
  const daysInMonth = new Date(year, month, 0).getDate();
  const today = new Date();
  
  let html = '';
  for(let i=0; i<firstDay; i++) html += `<div class="cal-day empty"></div>`;
  for(let day=1; day<=daysInMonth; day++) {
    let cls = 'cal-day';
    if(day === today.getDate() && month === today.getMonth()+1) cls += ' today';
    html += `<div class="${cls}" onclick="openDayModal(${day})">${day}</div>`;
  }
  grid.innerHTML = html;
}

function updateNextPrayerCounter() {
  if (!todayTimingsObj.Fajr) return;
  const now = new Date();
  const times = todayTimingsObj;
  const order = ['Fajr', 'Sunrise', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
  const names = { Fajr:'Ä°msak', Sunrise:'GÃ¼neÅŸ', Dhuhr:'Ã–ÄŸle', Asr:'Ä°kindi', Maghrib:'AkÅŸam', Isha:'YatsÄ±' };
  
  let nextP = null, nextT = null;
  const curMin = now.getHours() * 60 + now.getMinutes();

  for (let key of order) {
    const [h, m] = times[key].split(':').map(Number);
    if ((h * 60 + m) > curMin) {
      nextP = names[key];
      nextT = new Date(); nextT.setHours(h, m, 0);
      break;
    }
  }
  if (!nextP) {
    nextP = "YarÄ±n Ä°msak";
    const [h, m] = times.Fajr.split(':').map(Number);
    nextT = new Date(); nextT.setDate(now.getDate()+1); nextT.setHours(h, m, 0);
  }

  const diff = nextT - now;
  const h = Math.floor(diff / 3600000);
  const m = Math.floor((diff % 3600000) / 60000);
  const s = Math.floor((diff % 60000) / 1000);
  
  document.getElementById('next-prayer-name').textContent = nextP;
  document.getElementById('next-prayer-timer').textContent = `${h}:${m<10?'0'+m:m}:${s<10?'0'+s:s}`;
}

// Modal & YardÄ±mcÄ±lar
function showModal(title, content) {
  document.getElementById('modal-title').textContent = title;
  document.getElementById('modal-content').innerHTML = content;
  document.getElementById('generic-modal').classList.add('active');
}
function closeModal() { document.getElementById('generic-modal').classList.remove('active'); }
document.getElementById('generic-modal').addEventListener('click', (e) => { if(e.target.id==='generic-modal') closeModal(); });

function openDayModal(day) {
  const d = monthlyDataCache[day];
  if(!d) return;
  const t = d.timings;
  const html = `
    <div style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #eee;"><span>Ä°msak</span><b>${t.Fajr.split(' ')[0]}</b></div>
    <div style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #eee;"><span>GÃ¼neÅŸ</span><b>${t.Sunrise.split(' ')[0]}</b></div>
    <div style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #eee;"><span>Ã–ÄŸle</span><b>${t.Dhuhr.split(' ')[0]}</b></div>
    <div style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #eee;"><span>Ä°kindi</span><b>${t.Asr.split(' ')[0]}</b></div>
    <div style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #eee;"><span>AkÅŸam</span><b>${t.Maghrib.split(' ')[0]}</b></div>
    <div style="display:flex;justify-content:space-between;padding:8px 0;"><span>YatsÄ±</span><b>${t.Isha.split(' ')[0]}</b></div>
  `;
  showModal(`${day} ${document.getElementById('cal-month-year').textContent}`, html);
}

function updateDateDisplay() {
  document.getElementById('current-date-display').textContent = new Date().toLocaleDateString('tr-TR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
}
function changeMonth(d) { currentMonth+=d; if(currentMonth<0){currentMonth=11;currentYear--;}else if(currentMonth>11){currentMonth=0;currentYear++;} fetchMonthlyTimes(currentYear, currentMonth+1); }
function toggleTheme() { document.body.classList.toggle('dark-mode'); localStorage.setItem('theme', document.body.classList.contains('dark-mode')?'dark':'light'); document.getElementById('theme-icon').classList.toggle('fa-sun'); document.getElementById('theme-icon').classList.toggle('fa-moon'); }
function switchView(v) { 
  if(window.innerWidth<=900) { 
    document.getElementById('today-panel').style.display = v==='today'?'block':'none'; 
    document.querySelector('.right-panel').style.display = v==='calendar'?'block':'none';
  }
  document.querySelectorAll('.btn').forEach(b=>b.classList.remove('active'));
  document.getElementById(v==='today'?'btn-today':'btn-calendar').classList.add('active');
}
// Mobil ilk yÃ¼kleme ayarÄ±
if(window.innerWidth<=900) document.querySelector('.right-panel').style.display='none';
</script>
</body>
</html>
